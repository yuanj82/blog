<!doctype html><html lang=en><head><title>WSL 使用 Windows 侧代理 · Uncle4</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="YuanJiao"><meta name=description content="在 WSL2 中使用 git clone 下载 GitHub 上的项目时由于网络原因经常会失败，使用 Windows 侧的代理可以避免此类问题
WSL1 和 WSL2 的区别 Link to heading WSL1 和 WSL2 的网络主要有以下几个区别
WSL1 使用的是和 Windows 主机相同的网络栈，因此和 Windows 共享同一网络接口、IP 地址和 DNS 信息，但性能较差。
WSL2 使用了 Hyper-V 虚拟化技术，因此网络栈和 Windows 主机是隔离的，需要单独配置网络。WSL2 使用了虚拟化网络，每个 WSL2 实例对应一个虚拟交换机和虚拟网卡，该虚拟交换机相当于一个软件路由器，将 WSL2 的网络流量通过 Windows 主机的物理网卡转发到物理网络上。因此 WSL2 性能更好、更稳定，但需要单独配置网络，也可能存在一些网络配置上的问题。
WSL2 支持 Windows 本地主机的 SSH 连接，可以通过 SSH 连接 WSL2 中的 Linux 系统，而 WSL1 不支持此功能。
总体来说，WSL2 相较于 WSL1 更为出色，其虚拟网络技术能够提供更好的性能和更高的隔离性，同时对 SSH 的支持也更加完善。
WSL1 代理 Link to heading 由于 Linux 子系统和 Windows 共享了网络端口，所以访问 Windows 的代理非常简单。例如 Windows 的代理客户端监听了 8000 端口，那么只需要在 Linux 子系统中执行如下命令，就可以让当前 session 中的请求通过代理访问互联网。"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="WSL 使用 Windows 侧代理"><meta name=twitter:description content="在 WSL2 中使用 git clone 下载 GitHub 上的项目时由于网络原因经常会失败，使用 Windows 侧的代理可以避免此类问题
WSL1 和 WSL2 的区别 Link to heading WSL1 和 WSL2 的网络主要有以下几个区别
WSL1 使用的是和 Windows 主机相同的网络栈，因此和 Windows 共享同一网络接口、IP 地址和 DNS 信息，但性能较差。
WSL2 使用了 Hyper-V 虚拟化技术，因此网络栈和 Windows 主机是隔离的，需要单独配置网络。WSL2 使用了虚拟化网络，每个 WSL2 实例对应一个虚拟交换机和虚拟网卡，该虚拟交换机相当于一个软件路由器，将 WSL2 的网络流量通过 Windows 主机的物理网卡转发到物理网络上。因此 WSL2 性能更好、更稳定，但需要单独配置网络，也可能存在一些网络配置上的问题。
WSL2 支持 Windows 本地主机的 SSH 连接，可以通过 SSH 连接 WSL2 中的 Linux 系统，而 WSL1 不支持此功能。
总体来说，WSL2 相较于 WSL1 更为出色，其虚拟网络技术能够提供更好的性能和更高的隔离性，同时对 SSH 的支持也更加完善。
WSL1 代理 Link to heading 由于 Linux 子系统和 Windows 共享了网络端口，所以访问 Windows 的代理非常简单。例如 Windows 的代理客户端监听了 8000 端口，那么只需要在 Linux 子系统中执行如下命令，就可以让当前 session 中的请求通过代理访问互联网。"><meta property="og:title" content="WSL 使用 Windows 侧代理"><meta property="og:description" content="在 WSL2 中使用 git clone 下载 GitHub 上的项目时由于网络原因经常会失败，使用 Windows 侧的代理可以避免此类问题
WSL1 和 WSL2 的区别 Link to heading WSL1 和 WSL2 的网络主要有以下几个区别
WSL1 使用的是和 Windows 主机相同的网络栈，因此和 Windows 共享同一网络接口、IP 地址和 DNS 信息，但性能较差。
WSL2 使用了 Hyper-V 虚拟化技术，因此网络栈和 Windows 主机是隔离的，需要单独配置网络。WSL2 使用了虚拟化网络，每个 WSL2 实例对应一个虚拟交换机和虚拟网卡，该虚拟交换机相当于一个软件路由器，将 WSL2 的网络流量通过 Windows 主机的物理网卡转发到物理网络上。因此 WSL2 性能更好、更稳定，但需要单独配置网络，也可能存在一些网络配置上的问题。
WSL2 支持 Windows 本地主机的 SSH 连接，可以通过 SSH 连接 WSL2 中的 Linux 系统，而 WSL1 不支持此功能。
总体来说，WSL2 相较于 WSL1 更为出色，其虚拟网络技术能够提供更好的性能和更高的隔离性，同时对 SSH 的支持也更加完善。
WSL1 代理 Link to heading 由于 Linux 子系统和 Windows 共享了网络端口，所以访问 Windows 的代理非常简单。例如 Windows 的代理客户端监听了 8000 端口，那么只需要在 Linux 子系统中执行如下命令，就可以让当前 session 中的请求通过代理访问互联网。"><meta property="og:type" content="article"><meta property="og:url" content="https://yuanj.top/posts/d177c0aa/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-07T17:05:26+00:00"><meta property="article:modified_time" content="2023-06-07T17:05:26+00:00"><link rel=canonical href=https://yuanj.top/posts/d177c0aa/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a839119b1aa7bfc3e0055cdab3ff54c50c8f3701d2041e2bf06daea11936adc3.css integrity="sha256-qDkRmxqnv8PgBVzas/9UxQyPNwHSBB4r8G2uoRk2rcM=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/favicon.ico sizes=any><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Uncle4</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/essay/>Essay</a></li><li class=navigation-item><a class=navigation-link href=/gestbook/>Gestbook</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://yuanj.top/posts/d177c0aa/>WSL 使用 Windows 侧代理</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-06-07T17:05:26Z>June 7, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
One-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/wsl/>WSL</a></span></div></div></header><div class=post-content><blockquote><p>在 WSL2 中使用 git clone 下载 GitHub 上的项目时由于网络原因经常会失败，使用 Windows 侧的代理可以避免此类问题</p></blockquote><h2 id=wsl1-和-wsl2-的区别>WSL1 和 WSL2 的区别
<a class=heading-link href=#wsl1-%e5%92%8c-wsl2-%e7%9a%84%e5%8c%ba%e5%88%ab><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>WSL1 和 WSL2 的网络主要有以下几个区别</p><ol><li><p>WSL1 使用的是和 Windows 主机相同的网络栈，因此和 Windows 共享同一网络接口、IP 地址和 DNS 信息，但性能较差。</p></li><li><p>WSL2 使用了 Hyper-V 虚拟化技术，因此网络栈和 Windows 主机是隔离的，需要单独配置网络。WSL2 使用了虚拟化网络，每个 WSL2 实例对应一个虚拟交换机和虚拟网卡，该虚拟交换机相当于一个软件路由器，将 WSL2 的网络流量通过 Windows 主机的物理网卡转发到物理网络上。因此 WSL2 性能更好、更稳定，但需要单独配置网络，也可能存在一些网络配置上的问题。</p></li><li><p>WSL2 支持 Windows 本地主机的 SSH 连接，可以通过 SSH 连接 WSL2 中的 Linux 系统，而 WSL1 不支持此功能。</p></li></ol><p>总体来说，WSL2 相较于 WSL1 更为出色，其虚拟网络技术能够提供更好的性能和更高的隔离性，同时对 SSH 的支持也更加完善。</p><h2 id=wsl1-代理>WSL1 代理
<a class=heading-link href=#wsl1-%e4%bb%a3%e7%90%86><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>由于 Linux 子系统和 Windows 共享了网络端口，所以访问 Windows 的代理非常简单。例如 Windows 的代理客户端监听了 8000 端口，那么只需要在 Linux 子系统中执行如下命令，就可以让当前 session 中的请求通过代理访问互联网。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ALL_PROXY</span><span class=o>=</span><span class=s2>&#34;http://127.0.0.1:8000&#34;</span>
</span></span></code></pre></div><h2 id=wsl2-代理>WSL2 代理
<a class=heading-link href=#wsl2-%e4%bb%a3%e7%90%86><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>有两个关键步骤：</p><ol><li>WSL2 中配置的代理要指向 Windows 的 IP；</li><li>Windows 上的代理客户端需要允许来自本地局域网的请求；<br>由于 Linux 子系统也是通过 Windows 访问网络，所以 Linux 子系统中的网关指向的是 Windows，DNS 服务器指向的也是 Windows，基于这两个特性，我们可以将 Windows 的 IP 读取出来。</li></ol><p>例如，我使用的是 Debian 子系统，通过 <code>cat /etc/resolv.conf</code> 查看 DNS 服务器 IP。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:</span>
</span></span><span class=line><span class=cl><span class=c1>## [network]</span>
</span></span><span class=line><span class=cl><span class=c1>## generateResolvConf = false</span>
</span></span><span class=line><span class=cl>nameserver 172.27.144.1
</span></span></code></pre></div><p>可以看到 DNS 服务器是  <code>172.19.80.1</code>，通过环境变量  <code>ALL_PROXY</code>  配置代理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ALL_PROXY</span><span class=o>=</span><span class=s2>&#34;http://172.25.144.1:37507&#34;</span>
</span></span></code></pre></div><p>37507 是 Windows 上运行的代理客户端的端口，记得要在 Windows 代理客户端上配置允许本地局域网请求</p><h2 id=一键配置>一键配置
<a class=heading-link href=#%e4%b8%80%e9%94%ae%e9%85%8d%e7%bd%ae><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>将上面的过程写入终端配置文件，就可以一直使用代理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nv>host_ip</span><span class=o>=</span><span class=k>$(</span>cat /etc/resolv.conf <span class=p>|</span>grep <span class=s2>&#34;nameserver&#34;</span> <span class=p>|</span>cut -f <span class=m>2</span> -d <span class=s2>&#34; &#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ALL_PROXY</span><span class=o>=</span><span class=s2>&#34;socks5://</span><span class=nv>$host_ip</span><span class=s2>:37507&#34;</span>
</span></span></code></pre></div><p>脚本通过  <code>cat /etc/resolv.conf</code>  来获取 DNS 服务器，也就是 Windows 的 IP，再将其中的 IP 部分截取出来，加上代理客户端的端口（我的是 37507，可以根据自己实际情况修改），使用 export 写入环境变量中</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2023
YuanJiao</section></footer></main><script src=/js/coder.min.bf3def4cc889836d15cf3ab6357b9aaef07fabc3abf78b2a3b6eb00cd53c34e5.js integrity="sha256-vz3vTMiJg20Vzzq2NXuarvB/q8Or94sqO26wDNU8NOU="></script></body></html>