<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>对人类基因进行 GO 富集分析 - 猫四叔</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="对人类基因进行 GO 富集分析"><meta property="og:description" content="最近有一位师兄找我帮忙写一些 R 语言代码，实际上我也不怎么会，网上「借鉴」一些，自己改一些，达到目的似乎也就可以了。但是日后可能要经常和 R 语言打交道，所以还是研究清楚一些比较好。本文说说对人类基因进行注释并做 GO 富集分析。"><meta property="og:type" content="article"><meta property="og:url" content="https://yuanj.top/posts/j38df874h9/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-08T17:16:08+08:00"><meta property="article:modified_time" content="2023-11-08T17:16:08+08:00"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css></head><body class=body><div class="container container--outer"><header class=header><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div class="container header__container"><div class=logo><a class=logo__link href=/ title=猫四叔 rel=home><div class="logo__item logo__text"><div class=logo__title>猫四叔</div><div class=logo__tagline>思绪来得快去得也快，偶尔会在这里停留</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>对人类基因进行 GO 富集分析</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><time class=meta__text datetime=2023-11-08T17:16:08+08:00>November 08, 2023</time></div></div><div class=post_busuanzi><p>本文总阅读量 <span id=busuanzi_value_page_pv></span> 次</p></div></header><div class="content post__content clearfix"><p>最近有一位师兄找我帮忙写一些 R 语言代码，实际上我也不怎么会，网上「借鉴」一些，自己改一些，达到目的似乎也就可以了。但是日后可能要经常和 R 语言打交道，所以还是研究清楚一些比较好。本文说说对人类基因进行注释并做 GO 富集分析。</p><p>师兄那边给的数据是这样的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>symbol id
</span></span><span style=display:flex><span>HIF1A
</span></span><span style=display:flex><span>HIST2H3A
</span></span><span style=display:flex><span>GTF2E1
</span></span><span style=display:flex><span>FTSJ1
</span></span><span style=display:flex><span>DCD
</span></span><span style=display:flex><span>PRPF18
</span></span><span style=display:flex><span>UQCR11
</span></span><span style=display:flex><span>AKR1D1
</span></span><span style=display:flex><span>C5orf24
</span></span><span style=display:flex><span>TAF6
</span></span><span style=display:flex><span>RAB6C
</span></span><span style=display:flex><span>MTPAP
</span></span><span style=display:flex><span>TMEM205
</span></span><span style=display:flex><span>TUBGCP6
</span></span><span style=display:flex><span>SPDL1
</span></span><span style=display:flex><span>SECISBP2
</span></span><span style=display:flex><span>CCDC186
</span></span><span style=display:flex><span>HIST1H3A;HIST3H3;H3F3A;H3F3C
</span></span><span style=display:flex><span>KIAA0754
</span></span><span style=display:flex><span>EFEMP1
</span></span><span style=display:flex><span>LONP2
</span></span><span style=display:flex><span>REEP4
</span></span><span style=display:flex><span>TUBB2A
</span></span></code></pre></div><p>实际上就是一列人类基因的 symbol ID，这里需要注意的是 ID 的类型。</p><p>加载需要的 R 包：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>library </span>(org.Hs.eg.db)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library </span>(clusterProfiler)
</span></span></code></pre></div><p><code>org.Hs.eg.db</code> 包主要是对人类基因进行注释和 ID 转换，其他物种的类似包在 <a href=https://bioconductor.org/packages/release/BiocViews.html#___OrgDb>Bioconductor</a> 可以查看，但只有少数一些物种的。</p><p><code>clusterProfiler</code> 包是一个解释组学数据的通用富集工具许多基因集的功能注释和富集分析，以及富集分析结果的可视化，由余光创老师的课题组开发。clusterProfiler 支持的基因集 ( gene sets ) 或基因通路数据库有：Gene Ontology ( GO ) 、Kyoto Encyclopedia of Genes and Genomes ( KEGG ) 、Disease Ontology ( DO ) 、Disease Gene Network ( DisGeNET ) 、Molecular Signatures Database ( MSigDb ) 、wikiPathways 等。</p><p>读入基因列表 ( 如 human_genes.txt ) ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>genes <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>read.delim </span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;human_genes.txt&#39;</span>,
</span></span><span style=display:flex><span>    header <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>,
</span></span><span style=display:flex><span>    stringsAsFactors <span style=color:#f92672>=</span> <span style=color:#66d9ef>FALSE</span>
</span></span><span style=display:flex><span> ) [[1]]
</span></span></code></pre></div><p>使用 <code>enrich.go</code> 函数进行基因功能富集分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>enrich.go <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>enrichGO </span>(
</span></span><span style=display:flex><span>    gene <span style=color:#f92672>=</span> genes,          <span style=color:#75715e># 读入基因列表</span>
</span></span><span style=display:flex><span>    OrgDb <span style=color:#f92672>=</span> org.Hs.eg.db,  <span style=color:#75715e># 指定基因注释数据库</span>
</span></span><span style=display:flex><span>    keyType <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SYMBOL&#39;</span>,    <span style=color:#75715e># 指定 ID 类型</span>
</span></span><span style=display:flex><span>    ont <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ALL&#39;</span>,           <span style=color:#75715e># GO Ontology，可选 BP、MF、CC，也可以指定 ALL 同时计算 3 者</span>
</span></span><span style=display:flex><span>    pAdjustMethod <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;fdr&#39;</span>, <span style=color:#75715e># 指定 p 值校正方法</span>
</span></span><span style=display:flex><span>    pvalueCutoff <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.05</span>,   <span style=color:#75715e># 指定 p 值阈值 ( 可指定 1 以输出全部 )</span>
</span></span><span style=display:flex><span>    qvalueCutoff <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.2</span>,    <span style=color:#75715e># 指定 q 值阈值 ( 可指定 1 以输出全部 )</span>
</span></span><span style=display:flex><span>    readable <span style=color:#f92672>=</span> <span style=color:#66d9ef>FALSE</span>
</span></span><span style=display:flex><span> )
</span></span></code></pre></div><p>这里富集分析的时候需要的内存比较大，刚开始我 WSL 的 2GB 内存总是会爆满导致进程被迫关闭，后来去掉内存限制就可以了。</p><p>将富集分析结果写入文件 <code>entich.go.txt</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>write.table </span>(
</span></span><span style=display:flex><span>    enrich.go,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;entich.go.txt&#39;</span>,
</span></span><span style=display:flex><span>    sep <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\t&#39;</span>,
</span></span><span style=display:flex><span>    row.names <span style=color:#f92672>=</span> <span style=color:#66d9ef>FALSE</span>,
</span></span><span style=display:flex><span>    quote <span style=color:#f92672>=</span> <span style=color:#66d9ef>FALSE</span>
</span></span><span style=display:flex><span> )
</span></span></code></pre></div><p>使用自带函数绘图：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>dotplot </span>(enrich.go)
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/20231108173544.png alt></p><p>clusterProfiler 包里的一些默认作图方法，例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>barplot </span>(enrich.go) <span style=color:#75715e>#富集柱形图</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotplot </span>(enrich.go) <span style=color:#75715e>#富集气泡图</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cnetplot </span>(enrich.go) <span style=color:#75715e>#网络图展示富集功能和基因的包含关系</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>emapplot </span>(enrich.go) <span style=color:#75715e>#网络图展示各富集功能之间共有基因关系</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>heatplot </span>(enrich.go) <span style=color:#75715e>#热图展示富集功能和基因的包含关系</span>
</span></span></code></pre></div><p>clusterProfiler 包里的图有时候可能不会如我们的愿，于是截取 BP、MF、CC 三个部分的前十个数据，使用 ggplot2 进行绘图 ( 太多会导致很拥挤 ) ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Term    Fold Enrichment        PValue    Count
</span></span><span style=display:flex><span>ribonucleoprotein complex biogenesis    0.0644         1.43E-74    310
</span></span><span style=display:flex><span>mRNA processing    0.0619         1.19E-58    298
</span></span><span style=display:flex><span>ribosome biogenesis    0.0428         5.89E-56    206
</span></span><span style=display:flex><span>Golgi vesicle transport    0.0409         3.24E-50    197
</span></span><span style=display:flex><span>RNA splicing    0.0557         1.48E-48    268
</span></span><span style=display:flex><span>cytoplasmic translation    0.0264         2.50E-46    127
</span></span><span style=display:flex><span>rRNA processing    0.0322         8.50E-45    155
</span></span><span style=display:flex><span>establishment of protein localization to organelle    0.0532         1.67E-44    256
</span></span><span style=display:flex><span>rRNA metabolic process    0.0353         2.61E-42    170
</span></span><span style=display:flex><span>focal adhesion    0.0617         2.26E-92    304
</span></span><span style=display:flex><span>cell-substrate junction    0.0619         4.74E-89    305
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>library </span>(dplyr)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library </span>(ggplot2)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library </span>(ggrepel)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GO_data <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>read.table </span>( <span style=color:#e6db74>&#39;./data2.txt&#39;</span>, header <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>,  sep <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\t&#39;</span> )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GO_data <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>arrange </span>( GO_data, GO_data[,<span style=color:#ae81ff>3</span>] )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GO_data<span style=color:#f92672>$</span>Term <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>factor </span>( GO_data<span style=color:#f92672>$</span>Term, levels <span style=color:#f92672>=</span> <span style=color:#a6e22e>rev </span>( GO_data<span style=color:#f92672>$</span>Term ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mytheme <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>theme </span>(
</span></span><span style=display:flex><span>    axis.title <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_text </span>( face <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bold&#34;</span>, size <span style=color:#f92672>=</span> <span style=color:#ae81ff>14</span>, colour <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;black&#34;</span> ) ,
</span></span><span style=display:flex><span>    axis.text <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_text </span>( face <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bold&#34;</span>, size <span style=color:#f92672>=</span> <span style=color:#ae81ff>14</span>, colour <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;black&#34;</span> ) ,
</span></span><span style=display:flex><span>    axis.line <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_line </span>( size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span>, colour <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;black&#34;</span> ) ,
</span></span><span style=display:flex><span>    panel.background <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_rect </span>( colour <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;black&#34;</span> ) ,
</span></span><span style=display:flex><span>    legend.key <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_blank </span>( )
</span></span><span style=display:flex><span> )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>ggplot </span>(
</span></span><span style=display:flex><span>    GO_data,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>aes </span>(
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> Fold.Enrichment,
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> Term,
</span></span><span style=display:flex><span>        colour <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span><span style=color:#a6e22e>log10 </span>( PValue ) ,
</span></span><span style=display:flex><span>        size <span style=color:#f92672>=</span> Count
</span></span><span style=display:flex><span> )) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>geom_point </span>( ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scale_size </span>( range <span style=color:#f92672>=</span> <span style=color:#a6e22e>c </span>( <span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>8</span> )) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scale_colour_gradient </span>( low <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;blue&#34;</span>, high <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;red&#34;</span> ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>theme_bw </span>( ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ylab </span>( <span style=color:#e6db74>&#34;Terms&#34;</span> ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xlab </span>( <span style=color:#e6db74>&#34;Fold.Enrichment&#34;</span> ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>labs </span>( color <span style=color:#f92672>=</span> <span style=color:#a6e22e>expression </span>( <span style=color:#f92672>-</span>log [10<span style=color:#a6e22e>]</span>(PValue) ) ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>theme </span>( legend.title <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_text </span>( margin <span style=color:#f92672>=</span> <span style=color:#a6e22e>margin </span>( r <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span> )) , axis.title.x <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_text </span>( margin <span style=color:#f92672>=</span> <span style=color:#a6e22e>margin </span>( t <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span> )) ) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>theme </span>( axis.text.x <span style=color:#f92672>=</span> <span style=color:#a6e22e>element_text </span>( face <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bold&#34;</span>, colour <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;black&#34;</span>, angle <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, vjust <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> ))
</span></span><span style=display:flex><span>plot <span style=color:#f92672>&lt;-</span> p <span style=color:#f92672>+</span> mytheme
</span></span><span style=display:flex><span>plot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ggsave </span>( plot, filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GO.png&#34;</span>, width <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>, height <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>, dpi <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span> )
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/20231108173559.png alt></p></div></article></main><div class=comments><p>COMMENTS</p></div><div id=cusdis_thread data-host=https://cusdis.com data-app-id=3b34877a-34f0-4b03-a5f9-8ca25231e4cd data-page-id="对人类基因进行 GO 富集分析" data-page-url=https://yuanj.top/posts/j38df874h9/ data-page-title="对人类基因进行 GO 富集分析"></div><script async defer src=/js/cusdis.es.js></script></div></div></div><script async defer src=/js/menu.js></script></body></html>