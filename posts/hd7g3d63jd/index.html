<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Gromacs 分子动力学模拟 - 猫四叔</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Gromacs 分子动力学模拟"><meta property="og:description" content="近期做了一次分子动力学模拟实验，命令比较多，整理一下步骤，参考了生信实战的教程，但他们的教程存在很多问题，这里完善一下。
以江苏大学一位师兄提供的蛋白文件为基础，前提是要去除小分子，否则 gromacs 会报错提示有非标准残基。"><meta property="og:type" content="article"><meta property="og:url" content="https://yuanj.top/posts/hd7g3d63jd/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-15T18:16:25+08:00"><meta property="article:modified_time" content="2023-11-15T18:16:25+08:00"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css></head><body class=body><div class="container container--outer"><header class=header><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div class="container header__container"><div class=logo><a class=logo__link href=/ title=猫四叔 rel=home><div class="logo__item logo__text"><div class=logo__title>猫四叔</div><div class=logo__tagline>思绪来得快去得也快，偶尔会在这里停留</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Gromacs 分子动力学模拟</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><time class=meta__text datetime=2023-11-15T18:16:25+08:00>November 15, 2023</time></div></div><div class=post_busuanzi><p>本文总阅读量 <span id=busuanzi_value_page_pv></span> 次</p></div></header><div class="content post__content clearfix"><p>近期做了一次分子动力学模拟实验，命令比较多，整理一下步骤，参考了生信实战的教程，但他们的教程存在很多问题，这里完善一下。</p><p>以江苏大学一位师兄提供的蛋白文件为基础，前提是要去除小分子，否则 gromacs 会报错提示有非标准残基。</p><h2 id=环境准备>环境准备</h2><p>使用 conda 来安装软件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>conda create -n gmx python<span style=color:#f92672>=</span>3.9 <span style=color:#75715e>#创建虚拟环境</span>
</span></span><span style=display:flex><span>conda activate fmx
</span></span><span style=display:flex><span>conda install -c bioconda gromacs
</span></span></code></pre></div><p>安装完成后会 WARING，需要安装 pocl：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>conda install -c conda-forge pocl
</span></span></code></pre></div><h2 id=数据准备>数据准备</h2><p>准备好蛋白文件，我这里的蛋白文件是<code>YdcW_C284S.pdb</code>。</p><p>首先去除本实验中不需要的水分子，将去除水分子的蛋白文件命名为<code>YdcW_C284S.clean.pdb </code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>grep -v HOH YdcW_C284S.pdb &gt; YdcW_C284S.clean.pdb 
</span></span></code></pre></div><p>生成拓扑文件，并且将拓扑文件命名为<code>YdcW_C284S_processed.gro</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx pdb2gmx -f YdcW_C284S.clean.pdb -o YdcW_C284S_processed.gro -water spce
</span></span></code></pre></div><p>这时会提示我们进行选择，输入<code>15</code>选择<code>OPLS-AA/L all-atom force field (2001 aminoacid dihedrals)</code>力场。</p><p>执行后记录下体系的电荷情况，例如本例：<code>Total charge 9.000 e</code>。</p><p>接下来需要下载一些参数文件，为后面的分析做准备：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget http://www.mdtutorials.com/gmx/lysozyme/Files/ions.mdp
</span></span><span style=display:flex><span>wget http://www.mdtutorials.com/gmx/lysozyme/Files/minim.mdp
</span></span><span style=display:flex><span>wget http://www.mdtutorials.com/gmx/lysozyme/Files/nvt.mdp
</span></span><span style=display:flex><span>wget http://www.mdtutorials.com/gmx/lysozyme/Files/npt.mdp
</span></span><span style=display:flex><span>wget http://www.mdtutorials.com/gmx/lysozyme/Files/md.mdp
</span></span></code></pre></div><h2 id=定义模拟体系的尺寸并加水>定义模拟体系的尺寸并加水</h2><p>先使用 editconf 模块定义晶胞容器的尺寸，并且将处理后的文件命名为<code>YdcW_C284S_newbox.gro</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx editconf -f YdcW_C284S_processed.gro -o YdcW_C284S_newbox.gro -c -d 1.0 -bt cubic
</span></span></code></pre></div><p>使用 solvate 调用溶剂模块向晶胞容器中填充水：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx solvate -cp YdcW_C284S_newbox.gro -cs spc216.gro -o YdcW_C284S_solv.gro -p topol.top
</span></span></code></pre></div><h2 id=为模拟体系添加离子>为模拟体系添加离子</h2><p>生成<code>ions.tpr</code>文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx grompp -f ions.mdp -c YdcW_C284S_solv.gro -p topol.top -o ions.tpr
</span></span></code></pre></div><p>加入中和离子：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx genion -s ions.tpr -o YdcW_C284S_solv_ions.gro -p topol.top -pname NA -nname CL -neutral
</span></span></code></pre></div><p>选择 13 后回车。</p><h2 id=体系能量最小化>体系能量最小化</h2><p>生成能量最小化的拓扑文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx grompp -f minim.mdp -c YdcW_C284S_solv_ions.gro -p topol.top -o em.tpr
</span></span></code></pre></div><p>执行能量最小化：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx mdrun -v -deffnm em
</span></span></code></pre></div><p>这一步需要很长时间，所以建议使用下列命令挂在后台运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nohup gmx mdrun -v -deffnm em &amp;
</span></span></code></pre></div><p>gmx energy 模块来分析能量最小化的结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx energy -f em.edr -o potential.xvg
</span></span></code></pre></div><p>输入 10 0 来选择势能 Potential(10), 并用零 (0) 来结束输入。</p><p>xvg 文件可以使用 DuIvyTools 来进行查看，DuIvyTools 需要用 pip 来安装：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple <span style=color:#75715e>#设置为清华源</span>
</span></span><span style=display:flex><span>pip install DuIvyTools
</span></span></code></pre></div><p>使用下列命令查看</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f potential.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151946742.png alt></p><h2 id=nvt-温度平衡>NVT 温度平衡</h2><p>执行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx grompp -f nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
</span></span></code></pre></div><p>再执行下列命令，所需时间比较长，依旧挂在后台：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nohup gmx mdrun -deffnm nvt &amp;
</span></span></code></pre></div><p>平衡结果分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx energy -f nvt.edr -o temperature.xvg
</span></span></code></pre></div><p>输入 16 0，选择温度代号 16，选择 0 退出。</p><p>查看温度平衡情况：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f temperature.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151946187.png alt></p><h2 id=npt-压力平衡>NPT 压力平衡</h2><p>执行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx grompp -f npt.mdp -c nvt.gro -r nvt.gro -t nvt.cpt -p topol.top -o npt.tpr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nohup gmx mdrun -deffnm npt &amp;
</span></span></code></pre></div><p>压力分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx energy -f npt.edr -o pressure.xvg
</span></span></code></pre></div><p>根据提示输入 18 0 获得压力的数据结果。</p><p>查看压力分析结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f pressure.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151947851.png alt></p><p>密度分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx energy -f npt.edr -o density.xvg
</span></span></code></pre></div><p>根据提示 输入 24 0 获得结果。</p><p>查看压力分析结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f pressure.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151947188.png alt></p><h2 id=正式的动力学模拟>正式的动力学模拟</h2><p>执行 grompp 生成模拟的 tpr 文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx grompp -f md.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0_1.tpr
</span></span></code></pre></div><p>执行模拟：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nohup gmx mdrun -deffnm md_0_1 &amp; <span style=color:#75715e>#挂在后台</span>
</span></span></code></pre></div><h2 id=分子动力学模拟结果分析>分子动力学模拟结果分析</h2><p>使用下列命令进行修复：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx trjconv -s md_0_1.tpr -f md_0_1.xtc -o md_0_1_noPBC.xtc -pbc mol -center
</span></span></code></pre></div><p>选择 1 (Select 1 (&ldquo;Protein&rdquo;) as the group to be centered and 0 (&ldquo;System&rdquo;) for output) 完成后生成 md_0_1_noPBC.xtc，我们将基于这个修复的数据进行后续的数据分析。</p><p>计算 RMSD：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx rms -s md_0_1.tpr -f md_0_1_noPBC.xtc -o rmsd.xvg -tu ns
</span></span></code></pre></div><p>选择 4 (&ldquo;Backbone&rdquo;) for both the least-squares fit and the group for RMSD calculation。</p><p>查看 RMSD 结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f rmsd.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151947005.png alt></p><p>计算相对于模拟之前晶体的结构差异，可以使用下面的命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx rms -s em.tpr -f md_0_1_noPBC.xtc -o rmsd_xtal.xvg -tu ns
</span></span></code></pre></div><p>也是选择 4 (&ldquo;Backbone&rdquo;)。</p><p>计算回旋半径：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gmx gyrate -s md_0_1.tpr -f md_0_1_noPBC.xtc -o gyrate.xvg
</span></span></code></pre></div><p>选择 group 1 (Protein)，执行完成后新生成了 gyrate.xvg。</p><p>查看结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dit xvg_show -f gyrate.xvg
</span></span></code></pre></div><p><img src=https://jihulab.com/UncleCAT4/static/-/raw/main/blog/202311151957493.png alt></p><p>这一套流程都是按照默认参数和步骤来的，实际上我也不太懂，但是大多数情况下使用默认参数是足以满足实验需求。</p></div></article></main><div class=comments><p>COMMENTS</p></div><div id=cusdis_thread data-host=https://cusdis.com data-app-id=3b34877a-34f0-4b03-a5f9-8ca25231e4cd data-page-id="Gromacs 分子动力学模拟" data-page-url=https://yuanj.top/posts/hd7g3d63jd/ data-page-title="Gromacs 分子动力学模拟"></div><script async defer src=/js/cusdis.es.js></script></div></div></div><script async defer src=/js/menu.js></script></body></html>